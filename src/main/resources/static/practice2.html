<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>여러개 마커 표시하기</title>
    <link rel="stylesheet" href="asist.css">
    
</head>
<body>
    <div><h1 id="min_value">여기에 최소값을 표시할께요.</h1></div>
    <div><h2 id="nearest_station">여기에는 가장 가까운 소방서를 표시할께요.</h2></div>  <!--영호랑 상의해서 변수 맞추기-->
    <script>
        var latitude,
            longitude;

        navigator.geolocation.getCurrentPosition(function(pos) {
            console.log(pos);
            var latitude = pos.coords.latitude;
            var longitude = pos.coords.longitude;
            alert("현재 위치는 : " + latitude + ", "+ longitude + " 입니다.");

            var positions = [ //각 지점의 경도, 위도를 배열 형식으로 저장해 놓기 위한 positions 객체 생성
            {
                title: 'myhouse', 
                lat: latitude,
                lon: longitude
            },
            {
                title: 'A', 
                lat: 37.510300, 
                lon: 127.066900
            },
            {
                title: 'B', 
                lat: 37.558000, 
                lon: 126.860100
            },
            {
                title: 'C',
                lat: 37.529300, 
                lon: 127.125000
                
            },
            {
                title: 'D',
                lat: 37.497900, 
                lon: 126.865300
                
            },
            {
                title: 'E',
                lat: 37.473700, 
                lon: 126.952500
                
            }
            ];

            let arr = []; //distance를 저장해두는 배열집합
            let distance; //haversine 공식으로 나온 거리
            let min; //최소거리
            let min_firestation; //최소 거리에 있는 소방서
            let radius = 6371; //지구의 반지름
            let toRadian = Math.PI / 180; //라디안으로 바꾸기 위한 선언


            //Haversine 공식을 이용한 위도, 경도를 이용한 두 지점 사이의 거리 구하기
            for(let i=1; i<positions.length; i++){
                let deltaLatitude = Math.abs(positions[0].lat - positions[i].lat) * toRadian;
                let deltaLongtitude = Math.abs(positions[0].lon - positions[i].lon) * toRadian;

                let sinDeltaLat = Math.sin(deltaLatitude/2);
                let sinDeltaLng = Math.sin(deltaLongtitude/2);
                let squareRoot = Math.sqrt(sinDeltaLat*sinDeltaLat + Math.cos(positions[0].lat * toRadian) 
                * Math.cos(positions[i].lat * toRadian) * sinDeltaLng * sinDeltaLng);
                distance = 2 * radius * Math.asin(squareRoot);

                arr[i] = distance;
                
                console.log(arr[i]);
                
            }
            alert("여기까지 왔누");

            min = arr[1];
            for(let i=2; i<positions.length; i++){
                if(min>arr[i]){
                    min = arr[i];
                    min_firestation = positions[i].title;
                    console.log(min_firestation);
                }
                else{
                    continue;
                }    
            }
            alert("여기까지 왔어요");
            alert(min_firestation);

            document.getElementById("min_value").innerText = min;
            document.getElementById("nearest_station").innerText = min_firestation;
            

        });
        
    </script>

</body>